# youth_story_agent.py

import streamlit as st

class YouthStoryBuilderAgent:
    def __init__(self):
        self.story_theme = None
        self.selected_idea = None
        self.story_outline = None

    def classify_story_type(self, user_input):
        genres = [
            "æˆé•¿æ•…äº‹ï¼šä¸»è¦è®²è¿°é’å°‘å¹´åœ¨æˆé•¿è¿‡ç¨‹ä¸­çš„å¿ƒç†å˜åŒ–ã€äººç”Ÿé€‰æ‹©å’Œæˆé•¿å›°æƒ‘ï¼Œå…³æ³¨é’å°‘å¹´çš„è‡ªæˆ‘å‘ç°ä¸æˆé•¿ã€‚",
            "å†’é™©æ•…äº‹ï¼šé’å°‘å¹´è§’è‰²åœ¨æ¢ç´¢æœªçŸ¥çš„ä¸–ç•Œã€é¢å¯¹æŒ‘æˆ˜æ—¶å‘ç”Ÿçš„æ•…äº‹ï¼Œé€šå¸¸å……æ»¡åˆºæ¿€å’Œå†’é™©ã€‚",
            "æ ¡å›­æ•…äº‹ï¼šå›´ç»•é’å°‘å¹´åœ¨å­¦æ ¡çš„ç”Ÿæ´»å±•å¼€ï¼Œæç»˜ä»–ä»¬ä¸åŒå­¦ã€è€å¸ˆä¹‹é—´çš„å…³ç³»ï¼Œè§£å†³é—®é¢˜ï¼Œæˆé•¿ä¸å˜åŒ–ã€‚",
            "ç§‘å¹»/å¥‡å¹»æ•…äº‹ï¼šé’å°‘å¹´ä¸»è§’å‚ä¸è™šæ„çš„ã€è¶…ç°å®çš„ä¸–ç•Œï¼Œå¯èƒ½æ¶‰åŠå¤–æ˜Ÿã€æ—¶é—´æ—…è¡Œã€é­”æ³•ç­‰å…ƒç´ ã€‚",
            "å®¶åº­æ•…äº‹ï¼šå…³æ³¨é’å°‘å¹´ä¸å®¶åº­æˆå‘˜ä¹‹é—´çš„å…³ç³»ï¼Œå¯èƒ½æ¢è®¨å®¶åº­çŸ›ç›¾ã€äº²æƒ…å’Œæˆé•¿ç­‰è¯é¢˜ã€‚",
            "æ‚¬ç–‘/ä¾¦æ¢æ•…äº‹ï¼šä»¥é’å°‘å¹´ä¸ºä¸»è§’ï¼Œè§£å†³è°œé¢˜æˆ–æ­å¼€æ‚¬ç–‘ã€‚",
            "çˆ±æƒ…æ•…äº‹ï¼šé’å°‘å¹´åœ¨æˆé•¿è¿‡ç¨‹ä¸­ç»å†çš„çˆ±æƒ…æ•…äº‹ï¼Œå¯èƒ½æ˜¯åˆæ‹ã€æš—æ‹ç­‰ï¼Œæç»˜ä»–ä»¬çš„æƒ…æ„Ÿä½“éªŒã€‚"
        ]
        return [g for g in genres if any(t in user_input for t in g.split("ï¼š")[0])]

    def generate_story_ideas(self, theme):
        ideas = [
            f"ä¸€ä¸ªçƒ­å¿ƒé’å°‘å¹´å‘èµ·å­¦æ ¡æ¸…æ´æ—¥ï¼Œå”¤èµ·å¤§å®¶å¯¹å…¬å…±ç©ºé—´çš„è´£ä»»æ„Ÿã€‚",
            f"ä¸‰ä½åŒå­¦åˆ©ç”¨è¯¾ä½™æ—¶é—´å¸®åŠ©å¹´é•¿é‚»å±…ï¼Œå»ºç«‹ä»£é™…äº¤æµã€‚",
            f"ä¸€ä¸ªå†…å‘çš„å­¦ç”Ÿé€šè¿‡ç¤¾åŒºæœåŠ¡å‘ç°è¡¨è¾¾è‡ªå·±çš„å‹‡æ°”ã€‚",
            f"ä¸€ç¾¤é’å°‘å¹´æ”¹é€ è¢«é—å¼ƒçš„èŠ±å›­ï¼Œå­¦ä¼šåˆä½œä¸å¥‰çŒ®ã€‚",
            f"ä¸»è§’åœ¨ç…§é¡¾ç—…å¼±é‚»å±…çš„è¿‡ç¨‹ä¸­å‘ç°äº†è‡ªå·±æœªæ¥çš„å¿—å‘ã€‚"
        ]
        return ideas

    def build_outline(self, idea_number):
        self.story_outline = {
            "unit_1": "ç¬¬ä¸€å•å…ƒï¼šè§‰é†’æœåŠ¡æ„è¯†ï¼Œç»„æˆå›¢é˜Ÿï¼Œè®¾ç«‹ç›®æ ‡ã€‚ä¾§é‡æ€æƒ³åŠ›çš„æå‡å’Œå°ç»„åä½œã€‚",
            "unit_2": "ç¬¬äºŒå•å…ƒï¼šå¼€å±•çœŸå®æœåŠ¡è¡ŒåŠ¨ï¼Œé¢å¯¹æŒ‘æˆ˜ï¼Œåˆä½œæˆé•¿ï¼Œä½“ç°ç¤¾ä¼šè´¡çŒ®ä¸è‡ªæˆ‘å‘å±•ç»Ÿä¸€ã€‚"
        }
        return self.story_outline

    def write_chapter(self, unit):
        if unit == "unit_1":
            return (
                "ç¬¬ä¸€ç« ï¼šé˜³å…‰æ´’è¿›æ•™å®¤ï¼Œç­ä¸»ä»»åœ¨é»‘æ¿ä¸Šå†™ä¸‹â€œæ ¡å›­æ”¹å˜è¡ŒåŠ¨â€ã€‚ä¸»è§’å°æ°çµå…‰ä¸€é—ªï¼Œæå‡ºäº†æ¸…æ´æ ¡å›­çš„æƒ³æ³•ã€‚"
                "ä»–çš„æè®®ç«‹åˆ»å¼•å‘äº†çƒ­çƒˆè®¨è®ºã€‚ç­ä¸Šçš„å‡ ä¸ªå¥½å‹å¿—å¼ºã€å°æ…§ã€é˜¿èŠ³åŠ å…¥äº†å°æ°çš„è®¡åˆ’ã€‚"
                "ä»–ä»¬ç»„æˆäº†â€œæ ¡å›­æœåŠ¡å°é˜Ÿâ€ï¼Œåˆ†å·¥åˆä½œï¼Œåˆ¶å®šäº†ä¸€ä¸ªå‘¨æœ«æ¸…æ´æ ¡å›­çš„åˆæ­¥è®¡åˆ’ã€‚æ¯ä¸ªäººéƒ½çƒ­è¡€æ²¸è…¾ï¼Œè·ƒè·ƒæ¬²è¯•ã€‚"
            )
        elif unit == "unit_2":
            return (
                "ç¬¬äºŒç« ï¼šåˆ°äº†å‘¨æœ«ï¼Œå°é˜Ÿä¸€æ—©æ¥åˆ°å­¦æ ¡ï¼Œå´å‘ç°æ‰«å¸šå’Œåƒåœ¾è¢‹ä¸å¤Ÿç”¨ï¼Œå¤©è‰²ä¹Ÿé˜´æ²‰ä¸‹æ¥ã€‚"
                "ä½†æ²¡æœ‰äººé€€ç¼©ï¼Œå°æ°çµæœºä¸€åŠ¨ï¼Œå‘çœ‹é—¨çš„è€ç‹å€Ÿæ¥äº†å¤‡ç”¨å·¥å…·ã€‚æ¸…æ‰«è¿‡ç¨‹ä¸­ï¼Œä»–ä»¬å½¼æ­¤é¼“åŠ±ï¼Œè¿˜å¸å¼•äº†å…¶ä»–åŒå­¦åŠ å…¥ã€‚"
                "å½“é˜³å…‰å†æ¬¡éœ²é¢æ—¶ï¼Œæ•´ä¸ªæ ¡å›­ç„•ç„¶ä¸€æ–°ã€‚æ ¡é•¿ç»è¿‡æ—¶æŠ•æ¥èµè®¸çš„ç›®å…‰ï¼Œè€Œå°é˜Ÿæˆå‘˜ä¹Ÿä»æœåŠ¡ä¸­è·å¾—äº†å‰æ‰€æœªæœ‰çš„æ»¡è¶³ä¸æˆé•¿ã€‚"
            )

# === Streamlit App ===
def main():
    st.title("ğŸ“š Youth Story Builder Agent")
    st.write("å¸®åŠ©ä½ ä¸ºé’å°‘å¹´åˆ›ä½œå¯Œæœ‰æˆé•¿ä¸æœåŠ¡ç²¾ç¥çš„æ•…äº‹")

    agent = YouthStoryBuilderAgent()

    theme_input = st.text_input("è¯·è¾“å…¥ä½ æƒ³å¼ºè°ƒçš„æ•…äº‹ä¸»é¢˜å…³é”®è¯ï¼ˆå¦‚ æœåŠ¡ã€æˆé•¿ã€å®¶åº­ï¼‰ï¼š")
    if theme_input:
        genres = agent.classify_story_type(theme_input)
        st.write(f"è¯†åˆ«çš„é¢˜æç±»å‹ï¼š\n- " + "\n- ".join(genres))

        ideas = agent.generate_story_ideas(theme_input)
        selected_idea = st.selectbox("è¯·é€‰æ‹©ä¸€ä¸ªæ•…äº‹åˆ›æ„ï¼š", ideas)

        if selected_idea:
            idea_index = ideas.index(selected_idea) + 1
            outline = agent.build_outline(idea_index)
            st.subheader("ğŸ“‹ æ•…äº‹å¤§çº²")
            st.markdown(f"**å•å…ƒä¸€ï¼š** {outline['unit_1']}\n\n**å•å…ƒäºŒï¼š** {outline['unit_2']}")

            st.subheader("âœï¸ ç¬¬ä¸€ç« ï¼šå†…åœ¨è§‰é†’ä¸è¡ŒåŠ¨å¯åŠ¨")
            chapter1 = agent.write_chapter("unit_1")
            st.text_area("ç¬¬ä¸€ç« å†…å®¹ï¼š", value=chapter1, height=200)

            st.subheader("âœï¸ ç¬¬äºŒç« ï¼šæ·±åŒ–æˆé•¿ä¸ç¤¾ä¼šè´¡çŒ®")
            chapter2 = agent.write_chapter("unit_2")
            st.text_area("ç¬¬äºŒç« å†…å®¹ï¼š", value=chapter2, height=200)

if __name__ == "__main__":
    main()
